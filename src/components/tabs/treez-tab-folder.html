<!doctype html>
<html>

	<head>

		<link type="text/css" rel="stylesheet" href="treez-tab-folder.css" />

        <script>

            class TreezTabFolderHeader extends HTMLElement {}
            window.customElements.define('treez-tab-folder-header', TreezTabFolderHeader);

            class TreezTabHeader extends HTMLElement {}
            window.customElements.define('treez-tab-header', TreezTabHeader);

            class TreezTabFolder extends HTMLElement {

                constructor(){
                    super();
                    this.tabFolderHeader=undefined;
                }

                connectedCallback() {
                	
                    if(!this.tabFolderHeader){
                        this.style.display='block';                       
                        this.tabFolderHeader = document.createElement('treez-tab-folder-header');
                        this.insertBefore(this.tabFolderHeader, this.firstChild);																	            
                    }                    
                }               

                createTabHeaderForTabIfNotExists(tab){
                	if(!tab.tabHeader){
                		let tabFolderHeader = this.children[0]; 
						let newTabHeader = document.createElement('treez-tab-header');  
                    	newTabHeader.innerText = tab.title;
                    	newTabHeader.onclick=()=>{                    	
                        this.__hideAllTabs(); 
                        tab.style.display='block';
                        newTabHeader.classList.add('selected')                        
                    };
                    tab.tabHeader = newTabHeader;
                    tabFolderHeader.appendChild(newTabHeader);
                    this.__showFirstTab();
                	} 					 
                }

                __hideAllTabs(){
                	let children = this.children;
                	let tabFolderHeader = children[0];
                	let tabHeaders = tabFolderHeader.children;
                	for(let index=1;index<children.length;index++){ 
						let tab = children[index];                        
						tab.style.display='none';
						let tabHeader = tabHeaders[index-1];
						if(tabHeader){
							tabHeader.classList.remove('selected');
						}						
                    }   
                }

                __showFirstTab(){                	
                	let children = this.children;
                	let tabFolderHeader = children[0];

					let firstTabHeader = tabFolderHeader.children[0];
					firstTabHeader.classList.add('selected')
                    tabFolderHeader.style.display="block"                    
                    for(let index=1;index<children.length;index++){                            
                        children[index].style.display="none";
                    }   
                    children[1].style.display="block";                      
                }               

                disconnectedCallback(){
                    while (this.firstChild) {
						this.removeChild(this.firstChild);
					}
                }
            }
            window.customElements.define('treez-tab-folder', TreezTabFolder);


            class TreezTab extends HTMLElement {

                constructor(){
                    super();                   
                    this.tabHeader=undefined;
                }

                static get observedAttributes() {
                    return ['title']; 
                }               

                connectedCallback() { 
					let tabFolder = this.parentElement;
					if(tabFolder){			
						tabFolder.createTabHeaderForTabIfNotExists(this);
					}               
                }

                disconnectedCallback(){
                	//console.log('disconnected callback');
                	while (this.firstChild) {
						this.removeChild(this.firstChild);
					}
                }

                adoptedCallback(){
                    //console.log('adopted callback');
                }

                attributeChangedCallback(attr, oldValue, newValue) {
                    if(attr==='title' && this.tabHeader){
                        this.tabHeader.innerText= newValue;                       
                    }
                } 
               
            }
            window.customElements.define('treez-tab', TreezTab);

        </script>	
		
	</head>

</html>