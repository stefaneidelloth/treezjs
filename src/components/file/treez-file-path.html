<!doctype html>
<html>

	<head>

		<link type="text/css" rel="stylesheet" href="treez-file-path.css" />

		<link rel="import" href="./../treezElement.html" >	
	
        <script>
       
           	class TreezFilePath extends TreezElement {

            	static get observedAttributes() {
            		return TreezElement.observedAttributes.concat(['title']);                    
                }

                constructor(){
                    super();                  
                    this.labelElement=undefined;   
                    this.textField=undefined;
                    this.fileInput=undefined;                        
                }            	

                connectedCallback() {
                	var self = this;

                    if(!self.labelElement){                       

                        var labelElement = document.createElement('label');  
                        self.labelElement = labelElement;                     
                        labelElement.innerText = self.title;                       
                        self.appendChild(labelElement);  

                        var container = document.createElement('div');
                        container.id ='container';                       
                        self.appendChild(container);  

                        var leftSpan = document.createElement('span');
                        container.appendChild(leftSpan);                    

                        var textField = document.createElement('input');
                        self.textField = textField;   
                        textField.value = self.value;                    
                        textField.type='text'  
                        textField.onchange = ()=>this.__textFieldChanged();                                              
                        leftSpan.appendChild(textField);

                        var rightSpan = document.createElement('span');
                        container.appendChild(rightSpan); 

					    var fileInput = document.createElement('input');
					    self.fileInput = fileInput;						   
					    fileInput.type='file';
					    fileInput.title=' ';
					    fileInput.onchange = ()=>this.__fileInputChanged();				   
                        rightSpan.appendChild(fileInput);                       		
                    }
                }

                __textFieldChanged(){
                	this.value = this.textField.value;
                	this.fileInput.value = '';                	
                }

                __fileInputChanged(){
                	var file = this.fileInput.files[0]
                	if(file){
                		this.value = file.name;
                	    this.textField.value = this.value;
                	}
                }

                updateElements(newValue){
                	if(this.textField){ 
						this.textField.value= newValue;  

						if(this.fileInput){
							this.fileInput.value= '';   
						}
					}					    
                }                

                attributeChangedCallback(attr, oldValue, newValue) {
                	super.attributeChangedCallback(attr, oldValue, newValue) 
                    if(attr==='title'){
                    	if(this.labelElement){
                    		 this.labelElement.innerText= newValue;   
                    	}                                           
                    } 
                }               
               
            }
            window.customElements.define('treez-file-path', TreezFilePath);                    

        </script>	
		
	</head>

</html>