"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0}),require("focus-options-polyfill");var o=require("react"),t=e(o),n=require("react-dom"),r=e(require("react-use/lib/useEvent")),i=e(require("react-use/lib/useWindowSize")),a=require("tslib"),l=e(require("react-use/lib/usePrevious")),u=function(e){return e+"ms"},d=function(e){var o=e.height,t=e.innerHeight,n=e.innerWidth,r=e.isLoaded,i=e.isUnloading,l=e.left,d=e.originalTransform,c=e.top,s=e.transitionDuration,f=e.width,m=e.zoomMargin,v=u(s);if(!r||i){var g=a.__spreadArrays(["scale(1)","translate(0, 0)"],d?[d]:[]).join(" ");return{height:o,left:l,top:c,transform:g,WebkitTransform:g,transitionDuration:v,width:f}}var p=function(e){var o=e.height,t=e.innerHeight,n=e.innerWidth,r=e.width,i=e.zoomMargin,a=n/(r+i),l=t/(o+i);return Math.min(a,l)}({height:o,innerWidth:n,innerHeight:t,width:f,zoomMargin:m}),h=(n/2-(l+f/2))/p,b=(t/2-(c+o/2))/p,y=a.__spreadArrays(["scale("+p+")","translate("+h+"px, "+b+"px)"],d?[d]:[]).join(" ");return{height:o,left:l,top:c,transform:y,WebkitTransform:y,transitionDuration:v,width:f}},c=function(e){var o=e.isLoaded,t=e.isUnloading,n=e.overlayBgColorEnd,r=e.overlayBgColorStart,i=e.transitionDuration,a=e.zoomZindex,l={backgroundColor:r,transitionDuration:u(i),zIndex:a};return o&&!t&&(l.backgroundColor=n),l},s={getBoundingClientRect:function(){return{height:0,left:0,top:0,width:0}},style:{transform:null}},f=o.memo((function(e){var a=e.children,l=e.closeText,u=void 0===l?"Unzoom Image":l,f=e.onUnload,m=e.onLoad,v=e.overlayBgColorEnd,g=void 0===v?"rgba(255, 255, 255, 0.95)":v,p=e.overlayBgColorStart,h=void 0===p?"rgba(255, 255, 255, 0)":p,b=e.parentRef,y=e.portalEl,E=void 0===y?document.body:y,C=e.scrollableEl,z=void 0===C?window:C,w=e.transitionDuration,S=void 0===w?300:w,k=e.zoomMargin,x=void 0===k?0:k,B=e.zoomZindex,D=void 0===B?2147483647:B,T=o.useRef(null),M=o.useState(0)[1],Z=o.useState(!1),U=Z[0],R=Z[1],L=o.useState(!1),W=L[0],q=L[1],P=i(),_=P.width,H=P.height,j=o.useCallback((function(e){e.preventDefault(),q(!0)}),[]),A=o.useCallback((function(e){"Escape"!==e.key&&27!==e.keyCode||(e.stopPropagation(),q(!0))}),[]),I=o.useCallback((function(){M((function(e){return e+1})),W||q(!0)}),[W]);r("keydown",A,document),r("scroll",I,z),o.useEffect((function(){R(!0),m(),T.current&&T.current.focus({preventScroll:!0})}),[m]),o.useEffect((function(){var e=W?setTimeout(f,S):null;return function(){e&&clearTimeout(e)}}),[W,f,S]);var O=b.current||s,F=O.getBoundingClientRect(),G=F.height,J=F.left,K=F.top,N=F.width,Q=c({isLoaded:U,isUnloading:W,overlayBgColorEnd:g,overlayBgColorStart:h,transitionDuration:S,zoomZindex:D}),V=d({height:G,isLoaded:U,innerHeight:H,innerWidth:_,isUnloading:W,left:J,originalTransform:O.style.transform,top:K,transitionDuration:S,width:N,zoomMargin:x});return n.createPortal(t.createElement("div",{"aria-modal":!0,"data-rmiz-overlay":!0,role:"dialog",style:Q},t.createElement("div",{"data-rmiz-modal-content":!0,style:V},a),t.createElement("button",{"aria-label":u,"data-rmiz-btn-close":!0,onClick:j,ref:T})),E)})),m=o.memo((function(e){var n=e.children,r=e.closeText,i=void 0===r?"Unzoom image":r,a=e.overlayBgColorEnd,l=void 0===a?"rgba(255, 255, 255, 0.95)":a,u=e.overlayBgColorStart,d=void 0===u?"rgba(255, 255, 255, 0)":u,c=e.portalEl,s=e.openText,m=void 0===s?"Zoom image":s,v=e.scrollableEl,g=e.transitionDuration,p=void 0===g?300:g,h=e.wrapElement,b=void 0===h?"div":h,y=e.wrapStyle,E=e.zoomMargin,C=void 0===E?0:E,z=e.zoomZindex,w=void 0===z?2147483647:z,S=o.useState(!1),k=S[0],x=S[1],B=o.useState(!1),D=B[0],T=B[1],M=o.useRef(null),Z=o.useRef(null),U=o.useCallback((function(e){k||(e.preventDefault(),x(!0))}),[k]),R=o.useCallback((function(){T(!0)}),[]),L=o.useCallback((function(){x(!1),T(!1),Z.current&&Z.current.focus({preventScroll:!0})}),[]),W=k&&D?"hidden":"visible";return t.createElement(o.StrictMode,null,t.createElement(b,{"data-rmiz-wrap":W,ref:M,style:y},n,t.createElement("button",{"aria-label":m,"data-rmiz-btn-open":!0,onClick:U,ref:Z}),"undefined"!=typeof window&&k&&t.createElement(f,{closeText:i,onLoad:R,onUnload:L,overlayBgColorEnd:l,overlayBgColorStart:d,parentRef:M,portalEl:c,scrollableEl:v,transitionDuration:p,zoomMargin:C,zoomZindex:w},n)))})),v=o.memo((function(e){var a=e.children,u=e.closeText,f=void 0===u?"Unzoom Image":u,m=e.isActive,v=e.onLoad,g=e.onUnload,p=e.onZoomChange,h=e.overlayBgColorEnd,b=void 0===h?"rgba(255, 255, 255, 0.95)":h,y=e.overlayBgColorStart,E=void 0===y?"rgba(255, 255, 255, 0)":y,C=e.parentRef,z=e.portalEl,w=void 0===z?document.body:z,S=e.scrollableEl,k=void 0===S?window:S,x=e.transitionDuration,B=void 0===x?300:x,D=e.zoomMargin,T=void 0===D?0:D,M=e.zoomZindex,Z=void 0===M?2147483647:M,U=o.useRef(null),R=o.useState(0)[1],L=o.useState(m),W=L[0],q=L[1],P=o.useState(!1),_=P[0],H=P[1],j=o.useState(!1),A=j[0],I=j[1],O=l(W),F=l(m),G=l(_),J=i(),K=J.width,N=J.height,Q=o.useCallback((function(e){e.preventDefault(),p&&p(!1)}),[p]),V=o.useCallback((function(e){!W||"Escape"!==e.key&&27!==e.keyCode||(e.stopPropagation(),p&&p(!1))}),[W,p]),X=o.useCallback((function(){R((function(e){return e+1})),!A&&p&&p(!1)}),[A,p]);r("keydown",V,document),r("scroll",X,k),o.useEffect((function(){!O&&W&&(H(!0),U.current&&U.current.focus({preventScroll:!0}))}),[W,O]),o.useEffect((function(){F&&!m&&I(!0),!F&&m&&q(!0)}),[m,F]),o.useEffect((function(){var e;return A&&(e=setTimeout((function(){H(!1),q(!1),I(!1)}),B)),function(){clearTimeout(e)}}),[A,B]),o.useEffect((function(){!G&&_&&v(),G&&!_&&g()}),[_,v,g,G]);var Y=C.current||s,$=Y.getBoundingClientRect(),ee=$.height,oe=$.left,te=$.top,ne=$.width,re=c({isLoaded:_,isUnloading:A,overlayBgColorEnd:b,overlayBgColorStart:E,transitionDuration:B,zoomZindex:Z}),ie=d({height:ee,isLoaded:_,innerHeight:N,innerWidth:K,isUnloading:A,left:oe,originalTransform:Y.style.transform,top:te,transitionDuration:B,width:ne,zoomMargin:T});return W?n.createPortal(t.createElement("div",{"aria-modal":!0,"data-rmiz-overlay":!0,role:"dialog",style:re},t.createElement("div",{"data-rmiz-modal-content":!0,style:ie},a),t.createElement("button",{"aria-label":f,"data-rmiz-btn-close":!0,onClick:Q,ref:U,type:"button"})),w):null})),g=o.memo((function(e){var n=e.children,r=e.closeText,i=void 0===r?"Unzoom image":r,a=e.isZoomed,l=e.overlayBgColorEnd,u=void 0===l?"rgba(255, 255, 255, 0.95)":l,d=e.overlayBgColorStart,c=void 0===d?"rgba(255, 255, 255, 0)":d,s=e.portalEl,f=e.onZoomChange,m=e.openText,g=void 0===m?"Zoom image":m,p=e.scrollableEl,h=e.transitionDuration,b=void 0===h?300:h,y=e.wrapElement,E=void 0===y?"div":y,C=e.wrapStyle,z=e.zoomMargin,w=void 0===z?0:z,S=e.zoomZindex,k=void 0===S?2147483647:S,x=o.useState(!1),B=x[0],D=x[1],T=o.useRef(null),M=o.useRef(null),Z=o.useCallback((function(e){!a&&f&&(e.preventDefault(),f(!0))}),[a,f]),U=o.useCallback((function(){D(!0)}),[]),R=o.useCallback((function(){D(!1),M.current&&M.current.focus({preventScroll:!0})}),[]),L=B?"hidden":"visible";return t.createElement(o.StrictMode,null,t.createElement(E,{"data-rmiz-wrap":L,ref:T,style:C},n,t.createElement("button",{"aria-label":g,"data-rmiz-btn-open":!0,onClick:Z,ref:M,type:"button"}),"undefined"!=typeof window&&t.createElement(v,{closeText:i,isActive:a,onLoad:U,onUnload:R,onZoomChange:f,overlayBgColorEnd:u,overlayBgColorStart:c,parentRef:T,portalEl:s,scrollableEl:p,transitionDuration:b,zoomMargin:w,zoomZindex:k},n)))}));exports.Controlled=g,exports.default=m;
