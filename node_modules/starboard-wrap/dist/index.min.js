function e(){var e;const t=navigator.userAgent.match(/Firefox\/(\d+)/);if(null!==t){const e=parseInt(t[2]||"0");if(!isNaN(e)&&e<=91)return"camera;fullscreen;gamepad;geolocation;microphone;web-share"}const o=(null===(e=document.featurePolicy)||void 0===e?void 0:e.allowedFeatures)&&document.featurePolicy.allowedFeatures();return o?o.filter((e=>-1===["display-capture","document-domain","encrypted-media"].indexOf(e))).join(";"):"camera;fullscreen;geolocation;microphone;web-share;cross-origin-isolated;accelerometer;autoplay;gyroscope;magnetometer;midi;payment;picture-in-picture;publickey-credentials-get;sync-xhr;usb;screen-wake-lock;xr-spatial-tracking"}class t extends HTMLElement{constructor(e={}){super(),this.notebookContent="",this.lastSavedNotebookContent="",this.dirty=!1,this.version="0.4.1",this.hasReceivedReadyMessage=function(e){let t,o;const n=new Promise(((e,n)=>{t=e,o=n}));return e&&e(t,o),{promise:n,resolve:t,reject:o}}(),this.constructorOptions=e,this.style.display="block",this.constructorOptions.iFrame?this.iFrame=this.constructorOptions.iFrame:this.iFrame=this.querySelector("iframe")}connectedCallback(){var t,o,n,s,i,a,r,l,d,h,c,u,v,g,p,m;if(this.iFrame||(this.iFrame=this.querySelector("iframe"),this.iFrame||(this.iFrame=document.createElement("iframe"),this.appendChild(this.iFrame))),this.iFrame.style.width="100%",this.options=(t=this.constructorOptions,o=this.iFrame,{iFrame:t.iFrame||null,src:null!==(i=null!==(s=null!==(n=t.src)&&void 0!==n?n:o.getAttribute("src"))&&void 0!==s?s:window.starboardEmbedIFrameSrc)&&void 0!==i?i:"https://cdn.starboard.gg/npm/starboard-notebook@0.13.2/dist/index.html",baseUrl:t.baseUrl||o.dataset.baseUrl||void 0,autoResize:null===(a=t.autoResize)||void 0===a||a,sandbox:null!==(l=null!==(r=t.sandbox)&&void 0!==r?r:o.getAttribute("sandbox"))&&void 0!==l?l:"allow-scripts allow-modals allow-same-origin allow-pointer-lock allow-top-navigation-by-user-activation allow-forms allow-downloads",allow:null!==(h=null!==(d=t.allow)&&void 0!==d?d:o.getAttribute("allow"))&&void 0!==h?h:e(),onNotebookReadySignalMessage:null!==(c=t.onNotebookReadySignalMessage)&&void 0!==c?c:function(){},onContentUpdateMessage:null!==(u=t.onContentUpdateMessage)&&void 0!==u?u:function(){},onSaveMessage:null!==(v=t.onSaveMessage)&&void 0!==v?v:function(){},onMessage:null!==(g=t.onMessage)&&void 0!==g?g:function(){},onUnsavedChangesStatusChange:null!==(p=t.onUnsavedChangesStatusChange)&&void 0!==p?p:function(){},notebookContent:t.notebookContent,preventNavigationWithUnsavedChanges:null!==(m=t.preventNavigationWithUnsavedChanges)&&void 0!==m&&m}),this.options.preventNavigationWithUnsavedChanges&&(this.unsavedChangesWarningFunction=e=>{this.dirty&&(e.preventDefault(),e.returnValue="")},window.addEventListener("beforeunload",this.unsavedChangesWarningFunction)),!this.options.notebookContent){const e=this.querySelector("script");e&&(this.options.notebookContent=e.innerText)}this.iFrame.sandbox.value=this.options.sandbox,this.iFrame.allow||(this.iFrame.allow=this.options.allow),this.iFrame.src!==this.options.src&&(this.iFrame.src=this.options.src),this.iFrame.frameBorder="0",this.iFrameMessageHandler=async e=>{var t;if(null===e.source||e.source!==(null===(t=this.iFrame)||void 0===t?void 0:t.contentWindow))return;const o=this.options;if(!o)return;if(![new URL(o.src,location.origin).origin].includes(e.origin))return;if(!e.data)return;const n=e.data;if("NOTEBOOK_RESIZE_REQUEST"===n.type){const t=this.iFrame;o.autoResize&&t&&(t.setAttribute("scrolling","no"),t.style.height=`${e.data.payload.height+2}px`)}else if("NOTEBOOK_READY_SIGNAL"===n.type){if(o.notebookContent){const e=await o.notebookContent;this.notebookContent=e,this.lastSavedNotebookContent=this.notebookContent,this.sendMessage({type:"NOTEBOOK_SET_INIT_DATA",payload:{content:e,baseUrl:o.baseUrl}})}else this.notebookContent=n.payload.content,this.lastSavedNotebookContent=this.notebookContent;this.hasReceivedReadyMessage.resolve(n.payload),o.onNotebookReadySignalMessage(n.payload)}else if("NOTEBOOK_CONTENT_UPDATE"===n.type)this.notebookContent=n.payload.content,this.updateDirty(),o.onContentUpdateMessage(n.payload);else if("NOTEBOOK_SAVE_REQUEST"===n.type){this.notebookContent=n.payload.content,this.updateDirty();Promise.resolve(o.onSaveMessage(n.payload)).then((e=>{!0===e&&(this.lastSavedNotebookContent=n.payload.content,this.updateDirty())}))}o.onMessage(n)},window.addEventListener("message",this.iFrameMessageHandler)}sendMessage(e){this.hasReceivedReadyMessage.promise.then((()=>{var t,o;return null===(o=null===(t=this.iFrame)||void 0===t?void 0:t.contentWindow)||void 0===o?void 0:o.postMessage(e,"*")}))}setSaved(e){void 0===e&&(e=this.notebookContent),this.lastSavedNotebookContent=e,this.updateDirty()}updateDirty(){var e;const t=this.dirty;this.dirty=this.lastSavedNotebookContent!==this.notebookContent,this.dirty!==t&&(null===(e=this.options)||void 0===e||e.onUnsavedChangesStatusChange(this.dirty))}sendCustomMessage(e){this.sendMessage(e)}dispose(){this.iFrameMessageHandler&&window.removeEventListener("message",this.iFrameMessageHandler),this.unsavedChangesWarningFunction&&window.removeEventListener("beforeunload",this.unsavedChangesWarningFunction)}}customElements.define("starboard-embed",t);export{t as StarboardEmbed};
