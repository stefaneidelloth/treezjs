{"version":3,"file":"index.es.js","sources":["../src/keymap.js"],"sourcesContent":["import {base, keyName} from \"w3c-keyname\"\nimport {Plugin} from \"prosemirror-state\"\n\n// declare global: navigator\n\nconst mac = typeof navigator != \"undefined\" ? /Mac/.test(navigator.platform) : false\n\nfunction normalizeKeyName(name) {\n  let parts = name.split(/-(?!$)/), result = parts[parts.length - 1]\n  if (result == \"Space\") result = \" \"\n  let alt, ctrl, shift, meta\n  for (let i = 0; i < parts.length - 1; i++) {\n    let mod = parts[i]\n    if (/^(cmd|meta|m)$/i.test(mod)) meta = true\n    else if (/^a(lt)?$/i.test(mod)) alt = true\n    else if (/^(c|ctrl|control)$/i.test(mod)) ctrl = true\n    else if (/^s(hift)?$/i.test(mod)) shift = true\n    else if (/^mod$/i.test(mod)) { if (mac) meta = true; else ctrl = true }\n    else throw new Error(\"Unrecognized modifier name: \" + mod)\n  }\n  if (alt) result = \"Alt-\" + result\n  if (ctrl) result = \"Ctrl-\" + result\n  if (meta) result = \"Meta-\" + result\n  if (shift) result = \"Shift-\" + result\n  return result\n}\n\nfunction normalize(map) {\n  let copy = Object.create(null)\n  for (let prop in map) copy[normalizeKeyName(prop)] = map[prop]\n  return copy\n}\n\nfunction modifiers(name, event, shift) {\n  if (event.altKey) name = \"Alt-\" + name\n  if (event.ctrlKey) name = \"Ctrl-\" + name\n  if (event.metaKey) name = \"Meta-\" + name\n  if (shift !== false && event.shiftKey) name = \"Shift-\" + name\n  return name\n}\n\n// :: (Object) → Plugin\n// Create a keymap plugin for the given set of bindings.\n//\n// Bindings should map key names to [command](#commands)-style\n// functions, which will be called with `(EditorState, dispatch,\n// EditorView)` arguments, and should return true when they've handled\n// the key. Note that the view argument isn't part of the command\n// protocol, but can be used as an escape hatch if a binding needs to\n// directly interact with the UI.\n//\n// Key names may be strings like `\"Shift-Ctrl-Enter\"`—a key\n// identifier prefixed with zero or more modifiers. Key identifiers\n// are based on the strings that can appear in\n// [`KeyEvent.key`](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key).\n// Use lowercase letters to refer to letter keys (or uppercase letters\n// if you want shift to be held). You may use `\"Space\"` as an alias\n// for the `\" \"` name.\n//\n// Modifiers can be given in any order. `Shift-` (or `s-`), `Alt-` (or\n// `a-`), `Ctrl-` (or `c-` or `Control-`) and `Cmd-` (or `m-` or\n// `Meta-`) are recognized. For characters that are created by holding\n// shift, the `Shift-` prefix is implied, and should not be added\n// explicitly.\n//\n// You can use `Mod-` as a shorthand for `Cmd-` on Mac and `Ctrl-` on\n// other platforms.\n//\n// You can add multiple keymap plugins to an editor. The order in\n// which they appear determines their precedence (the ones early in\n// the array get to dispatch first).\nexport function keymap(bindings) {\n  return new Plugin({props: {handleKeyDown: keydownHandler(bindings)}})\n}\n\n// :: (Object) → (view: EditorView, event: dom.Event) → bool\n// Given a set of bindings (using the same format as\n// [`keymap`](#keymap.keymap), return a [keydown\n// handler](#view.EditorProps.handleKeyDown) that handles them.\nexport function keydownHandler(bindings) {\n  let map = normalize(bindings)\n  return function(view, event) {\n    let name = keyName(event), isChar = name.length == 1 && name != \" \", baseName\n    let direct = map[modifiers(name, event, !isChar)]\n    if (direct && direct(view.state, view.dispatch, view)) return true\n    if (isChar && (event.shiftKey || event.altKey || event.metaKey || name.charCodeAt(0) > 127) &&\n        (baseName = base[event.keyCode]) && baseName != name) {\n      // Try falling back to the keyCode when there's a modifier\n      // active or the character produced isn't ASCII, and our table\n      // produces a different name from the the keyCode. See #668,\n      // #1060\n      let fromCode = map[modifiers(baseName, event, true)]\n      if (fromCode && fromCode(view.state, view.dispatch, view)) return true\n    } else if (isChar && event.shiftKey) {\n      // Otherwise, if shift is active, also try the binding with the\n      // Shift- prefix enabled. See #997\n      let withShift = map[modifiers(name, event, true)]\n      if (withShift && withShift(view.state, view.dispatch, view)) return true\n    }\n    return false\n  }\n}\n"],"names":["const","let"],"mappings":"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"}