{"version":3,"file":"index.js","sources":["../src/icons.js","../src/menu.js","../src/menubar.js"],"sourcesContent":["const SVG = \"http://www.w3.org/2000/svg\"\nconst XLINK = \"http://www.w3.org/1999/xlink\"\n\nconst prefix = \"ProseMirror-icon\"\n\nfunction hashPath(path) {\n  let hash = 0\n  for (let i = 0; i < path.length; i++)\n    hash = (((hash << 5) - hash) + path.charCodeAt(i)) | 0\n  return hash\n}\n\nexport function getIcon(icon) {\n  let node = document.createElement(\"div\")\n  node.className = prefix\n  if (icon.path) {\n    let name = \"pm-icon-\" + hashPath(icon.path).toString(16)\n    if (!document.getElementById(name)) buildSVG(name, icon)\n    let svg = node.appendChild(document.createElementNS(SVG, \"svg\"))\n    svg.style.width = (icon.width / icon.height) + \"em\"\n    let use = svg.appendChild(document.createElementNS(SVG, \"use\"))\n    use.setAttributeNS(XLINK, \"href\", /([^#]*)/.exec(document.location)[1] + \"#\" + name)\n  } else if (icon.dom) {\n    node.appendChild(icon.dom.cloneNode(true))\n  } else {\n    node.appendChild(document.createElement(\"span\")).textContent = icon.text || ''\n    if (icon.css) node.firstChild.style.cssText = icon.css\n  }\n  return node\n}\n\nfunction buildSVG(name, data) {\n  let collection = document.getElementById(prefix + \"-collection\")\n  if (!collection) {\n    collection = document.createElementNS(SVG, \"svg\")\n    collection.id = prefix + \"-collection\"\n    collection.style.display = \"none\"\n    document.body.insertBefore(collection, document.body.firstChild)\n  }\n  let sym = document.createElementNS(SVG, \"symbol\")\n  sym.id = name\n  sym.setAttribute(\"viewBox\", \"0 0 \" + data.width + \" \" + data.height)\n  let path = sym.appendChild(document.createElementNS(SVG, \"path\"))\n  path.setAttribute(\"d\", data.path)\n  collection.appendChild(sym)\n}\n","import crel from \"crelt\"\nimport {lift, joinUp, selectParentNode, wrapIn, setBlockType} from \"prosemirror-commands\"\nimport {undo, redo} from \"prosemirror-history\"\n\nimport {getIcon} from \"./icons\"\n\nconst prefix = \"ProseMirror-menu\"\n\n// ::- An icon or label that, when clicked, executes a command.\nexport class MenuItem {\n  // :: (MenuItemSpec)\n  constructor(spec) {\n    // :: MenuItemSpec\n    // The spec used to create the menu item.\n    this.spec = spec\n  }\n\n  // :: (EditorView) → {dom: dom.Node, update: (EditorState) → bool}\n  // Renders the icon according to its [display\n  // spec](#menu.MenuItemSpec.display), and adds an event handler which\n  // executes the command when the representation is clicked.\n  render(view) {\n    let spec = this.spec\n    let dom = spec.render ? spec.render(view)\n        : spec.icon ? getIcon(spec.icon)\n        : spec.label ? crel(\"div\", null, translate(view, spec.label))\n        : null\n    if (!dom) throw new RangeError(\"MenuItem without icon or label property\")\n    if (spec.title) {\n      const title = (typeof spec.title === \"function\" ? spec.title(view.state) : spec.title)\n      dom.setAttribute(\"title\", translate(view, title))\n    }\n    if (spec.class) dom.classList.add(spec.class)\n    if (spec.css) dom.style.cssText += spec.css\n\n    dom.addEventListener(\"mousedown\", e => {\n      e.preventDefault()\n      if (!dom.classList.contains(prefix + \"-disabled\"))\n        spec.run(view.state, view.dispatch, view, e)\n    })\n\n    function update(state) {\n      if (spec.select) {\n        let selected = spec.select(state)\n        dom.style.display = selected ? \"\" : \"none\"\n        if (!selected) return false\n      }\n      let enabled = true\n      if (spec.enable) {\n        enabled = spec.enable(state) || false\n        setClass(dom, prefix + \"-disabled\", !enabled)\n      }\n      if (spec.active) {\n        let active = enabled && spec.active(state) || false\n        setClass(dom, prefix + \"-active\", active)\n      }\n      return true\n    }\n\n    return {dom, update}\n  }\n}\n\nfunction translate(view, text) {\n  return view._props.translate ? view._props.translate(text) : text\n}\n\n// MenuItemSpec:: interface\n// The configuration object passed to the `MenuItem` constructor.\n//\n//   run:: (EditorState, (Transaction), EditorView, dom.Event)\n//   The function to execute when the menu item is activated.\n//\n//   select:: ?(EditorState) → bool\n//   Optional function that is used to determine whether the item is\n//   appropriate at the moment. Deselected items will be hidden.\n//\n//   enable:: ?(EditorState) → bool\n//   Function that is used to determine if the item is enabled. If\n//   given and returning false, the item will be given a disabled\n//   styling.\n//\n//   active:: ?(EditorState) → bool\n//   A predicate function to determine whether the item is 'active' (for\n//   example, the item for toggling the strong mark might be active then\n//   the cursor is in strong text).\n//\n//   render:: ?(EditorView) → dom.Node\n//   A function that renders the item. You must provide either this,\n//   [`icon`](#menu.MenuItemSpec.icon), or [`label`](#MenuItemSpec.label).\n//\n//   icon:: ?Object\n//   Describes an icon to show for this item. The object may specify\n//   an SVG icon, in which case its `path` property should be an [SVG\n//   path\n//   spec](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d),\n//   and `width` and `height` should provide the viewbox in which that\n//   path exists. Alternatively, it may have a `text` property\n//   specifying a string of text that makes up the icon, with an\n//   optional `css` property giving additional CSS styling for the\n//   text. _Or_ it may contain `dom` property containing a DOM node.\n//\n//   label:: ?string\n//   Makes the item show up as a text label. Mostly useful for items\n//   wrapped in a [drop-down](#menu.Dropdown) or similar menu. The object\n//   should have a `label` property providing the text to display.\n//\n//   title:: ?union<string, (EditorState) → string>\n//   Defines DOM title (mouseover) text for the item.\n//\n//   class:: ?string\n//   Optionally adds a CSS class to the item's DOM representation.\n//\n//   css:: ?string\n//   Optionally adds a string of inline CSS to the item's DOM\n//   representation.\n\nlet lastMenuEvent = {time: 0, node: null}\nfunction markMenuEvent(e) {\n  lastMenuEvent.time = Date.now()\n  lastMenuEvent.node = e.target\n}\nfunction isMenuEvent(wrapper) {\n  return Date.now() - 100 < lastMenuEvent.time &&\n    lastMenuEvent.node && wrapper.contains(lastMenuEvent.node)\n}\n\n// ::- A drop-down menu, displayed as a label with a downwards-pointing\n// triangle to the right of it.\nexport class Dropdown {\n  // :: ([MenuElement], ?Object)\n  // Create a dropdown wrapping the elements. Options may include\n  // the following properties:\n  //\n  // **`label`**`: string`\n  //   : The label to show on the drop-down control.\n  //\n  // **`title`**`: string`\n  //   : Sets the\n  //     [`title`](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/title)\n  //     attribute given to the menu control.\n  //\n  // **`class`**`: string`\n  //   : When given, adds an extra CSS class to the menu control.\n  //\n  // **`css`**`: string`\n  //   : When given, adds an extra set of CSS styles to the menu control.\n  constructor(content, options) {\n    this.options = options || {}\n    this.content = Array.isArray(content) ? content : [content]\n  }\n\n  // :: (EditorView) → {dom: dom.Node, update: (EditorState)}\n  // Render the dropdown menu and sub-items.\n  render(view) {\n    let content = renderDropdownItems(this.content, view)\n\n    let label = crel(\"div\", {class: prefix + \"-dropdown \" + (this.options.class || \"\"),\n                             style: this.options.css},\n                     translate(view, this.options.label))\n    if (this.options.title) label.setAttribute(\"title\", translate(view, this.options.title))\n    let wrap = crel(\"div\", {class: prefix + \"-dropdown-wrap\"}, label)\n    let open = null, listeningOnClose = null\n    let close = () => {\n      if (open && open.close()) {\n        open = null\n        window.removeEventListener(\"mousedown\", listeningOnClose)\n      }\n    }\n    label.addEventListener(\"mousedown\", e => {\n      e.preventDefault()\n      markMenuEvent(e)\n      if (open) {\n        close()\n      } else {\n        open = this.expand(wrap, content.dom)\n        window.addEventListener(\"mousedown\", listeningOnClose = () => {\n          if (!isMenuEvent(wrap)) close()\n        })\n      }\n    })\n\n    function update(state) {\n      let inner = content.update(state)\n      wrap.style.display = inner ? \"\" : \"none\"\n      return inner\n    }\n\n    return {dom: wrap, update}\n  }\n\n  expand(dom, items) {\n    let menuDOM = crel(\"div\", {class: prefix + \"-dropdown-menu \" + (this.options.class || \"\")}, items)\n\n    let done = false\n    function close() {\n      if (done) return\n      done = true\n      dom.removeChild(menuDOM)\n      return true\n    }\n    dom.appendChild(menuDOM)\n    return {close, node: menuDOM}\n  }\n}\n\nfunction renderDropdownItems(items, view) {\n  let rendered = [], updates = []\n  for (let i = 0; i < items.length; i++) {\n    let {dom, update} = items[i].render(view)\n    rendered.push(crel(\"div\", {class: prefix + \"-dropdown-item\"}, dom))\n    updates.push(update)\n  }\n  return {dom: rendered, update: combineUpdates(updates, rendered)}\n}\n\nfunction combineUpdates(updates, nodes) {\n  return state => {\n    let something = false\n    for (let i = 0; i < updates.length; i++) {\n      let up = updates[i](state)\n      nodes[i].style.display = up ? \"\" : \"none\"\n      if (up) something = true\n    }\n    return something\n  }\n}\n\n// ::- Represents a submenu wrapping a group of elements that start\n// hidden and expand to the right when hovered over or tapped.\nexport class DropdownSubmenu {\n  // :: ([MenuElement], ?Object)\n  // Creates a submenu for the given group of menu elements. The\n  // following options are recognized:\n  //\n  // **`label`**`: string`\n  //   : The label to show on the submenu.\n  constructor(content, options) {\n    this.options = options || {}\n    this.content = Array.isArray(content) ? content : [content]\n  }\n\n  // :: (EditorView) → {dom: dom.Node, update: (EditorState) → bool}\n  // Renders the submenu.\n  render(view) {\n    let items = renderDropdownItems(this.content, view)\n\n    let label = crel(\"div\", {class: prefix + \"-submenu-label\"}, translate(view, this.options.label))\n    let wrap = crel(\"div\", {class: prefix + \"-submenu-wrap\"}, label,\n                   crel(\"div\", {class: prefix + \"-submenu\"}, items.dom))\n    let listeningOnClose = null\n    label.addEventListener(\"mousedown\", e => {\n      e.preventDefault()\n      markMenuEvent(e)\n      setClass(wrap, prefix + \"-submenu-wrap-active\")\n      if (!listeningOnClose)\n        window.addEventListener(\"mousedown\", listeningOnClose = () => {\n          if (!isMenuEvent(wrap)) {\n            wrap.classList.remove(prefix + \"-submenu-wrap-active\")\n            window.removeEventListener(\"mousedown\", listeningOnClose)\n            listeningOnClose = null\n          }\n        })\n    })\n\n    function update(state) {\n      let inner = items.update(state)\n      wrap.style.display = inner ? \"\" : \"none\"\n      return inner\n    }\n    return {dom: wrap, update}\n  }\n}\n\n// :: (EditorView, [union<MenuElement, [MenuElement]>]) → {dom: ?dom.DocumentFragment, update: (EditorState) → bool}\n// Render the given, possibly nested, array of menu elements into a\n// document fragment, placing separators between them (and ensuring no\n// superfluous separators appear when some of the groups turn out to\n// be empty).\nexport function renderGrouped(view, content) {\n  let result = document.createDocumentFragment()\n  let updates = [], separators = []\n  for (let i = 0; i < content.length; i++) {\n    let items = content[i], localUpdates = [], localNodes = []\n    for (let j = 0; j < items.length; j++) {\n      let {dom, update} = items[j].render(view)\n      let span = crel(\"span\", {class: prefix + \"item\"}, dom)\n      result.appendChild(span)\n      localNodes.push(span)\n      localUpdates.push(update)\n    }\n    if (localUpdates.length) {\n      updates.push(combineUpdates(localUpdates, localNodes))\n      if (i < content.length - 1)\n        separators.push(result.appendChild(separator()))\n    }\n  }\n\n  function update(state) {\n    let something = false, needSep = false\n    for (let i = 0; i < updates.length; i++) {\n      let hasContent = updates[i](state)\n      if (i) separators[i - 1].style.display = needSep && hasContent ? \"\" : \"none\"\n      needSep = hasContent\n      if (hasContent) something = true\n    }\n    return something\n  }\n  return {dom: result, update}\n}\n\nfunction separator() {\n  return crel(\"span\", {class: prefix + \"separator\"})\n}\n\n// :: Object\n// A set of basic editor-related icons. Contains the properties\n// `join`, `lift`, `selectParentNode`, `undo`, `redo`, `strong`, `em`,\n// `code`, `link`, `bulletList`, `orderedList`, and `blockquote`, each\n// holding an object that can be used as the `icon` option to\n// `MenuItem`.\nexport const icons = {\n  join: {\n    width: 800, height: 900,\n    path: \"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z\"\n  },\n  lift: {\n    width: 1024, height: 1024,\n    path: \"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z\"\n  },\n  selectParentNode: {text: \"\\u2b1a\", css: \"font-weight: bold\"},\n  undo: {\n    width: 1024, height: 1024,\n    path: \"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z\"\n  },\n  redo: {\n    width: 1024, height: 1024,\n    path: \"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z\"\n  },\n  strong: {\n    width: 805, height: 1024,\n    path: \"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z\"\n  },\n  em: {\n    width: 585, height: 1024,\n    path: \"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z\"\n  },\n  code: {\n    width: 896, height: 1024,\n    path: \"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z\"\n  },\n  link: {\n    width: 951, height: 1024,\n    path: \"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z\"\n  },\n  bulletList: {\n    width: 768, height: 896,\n    path: \"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z\"\n  },\n  orderedList: {\n    width: 768, height: 896,\n    path: \"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z\"\n  },\n  blockquote: {\n    width: 640, height: 896,\n    path: \"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z\"\n  }\n}\n\n// :: MenuItem\n// Menu item for the `joinUp` command.\nexport const joinUpItem = new MenuItem({\n  title: \"Join with above block\",\n  run: joinUp,\n  select: state => joinUp(state),\n  icon: icons.join\n})\n\n// :: MenuItem\n// Menu item for the `lift` command.\nexport const liftItem = new MenuItem({\n  title: \"Lift out of enclosing block\",\n  run: lift,\n  select: state => lift(state),\n  icon: icons.lift\n})\n\n// :: MenuItem\n// Menu item for the `selectParentNode` command.\nexport const selectParentNodeItem = new MenuItem({\n  title: \"Select parent node\",\n  run: selectParentNode,\n  select: state => selectParentNode(state),\n  icon: icons.selectParentNode\n})\n\n// :: MenuItem\n// Menu item for the `undo` command.\nexport let undoItem = new MenuItem({\n  title: \"Undo last change\",\n  run: undo,\n  enable: state => undo(state),\n  icon: icons.undo\n})\n\n// :: MenuItem\n// Menu item for the `redo` command.\nexport let redoItem = new MenuItem({\n  title: \"Redo last undone change\",\n  run: redo,\n  enable: state => redo(state),\n  icon: icons.redo\n})\n\n// :: (NodeType, Object) → MenuItem\n// Build a menu item for wrapping the selection in a given node type.\n// Adds `run` and `select` properties to the ones present in\n// `options`. `options.attrs` may be an object or a function.\nexport function wrapItem(nodeType, options) {\n  let passedOptions = {\n    run(state, dispatch) {\n      // FIXME if (options.attrs instanceof Function) options.attrs(state, attrs => wrapIn(nodeType, attrs)(state))\n      return wrapIn(nodeType, options.attrs)(state, dispatch)\n    },\n    select(state) {\n      return wrapIn(nodeType, options.attrs instanceof Function ? null : options.attrs)(state)\n    }\n  }\n  for (let prop in options) passedOptions[prop] = options[prop]\n  return new MenuItem(passedOptions)\n}\n\n// :: (NodeType, Object) → MenuItem\n// Build a menu item for changing the type of the textblock around the\n// selection to the given type. Provides `run`, `active`, and `select`\n// properties. Others must be given in `options`. `options.attrs` may\n// be an object to provide the attributes for the textblock node.\nexport function blockTypeItem(nodeType, options) {\n  let command = setBlockType(nodeType, options.attrs)\n  let passedOptions = {\n    run: command,\n    enable(state) { return command(state) },\n    active(state) {\n      let {$from, to, node} = state.selection\n      if (node) return node.hasMarkup(nodeType, options.attrs)\n      return to <= $from.end() && $from.parent.hasMarkup(nodeType, options.attrs)\n    }\n  }\n  for (let prop in options) passedOptions[prop] = options[prop]\n  return new MenuItem(passedOptions)\n}\n\n// Work around classList.toggle being broken in IE11\nfunction setClass(dom, cls, on) {\n  if (on) dom.classList.add(cls)\n  else dom.classList.remove(cls)\n}\n","import crel from \"crelt\"\nimport {Plugin} from \"prosemirror-state\"\n\nimport {renderGrouped} from \"./menu\"\n\nconst prefix = \"ProseMirror-menubar\"\n\nfunction isIOS() {\n  if (typeof navigator == \"undefined\") return false\n  let agent = navigator.userAgent\n  return !/Edge\\/\\d/.test(agent) && /AppleWebKit/.test(agent) && /Mobile\\/\\w+/.test(agent)\n}\n\n// :: (Object) → Plugin\n// A plugin that will place a menu bar above the editor. Note that\n// this involves wrapping the editor in an additional `<div>`.\n//\n//   options::-\n//   Supports the following options:\n//\n//     content:: [[MenuElement]]\n//     Provides the content of the menu, as a nested array to be\n//     passed to `renderGrouped`.\n//\n//     floating:: ?bool\n//     Determines whether the menu floats, i.e. whether it sticks to\n//     the top of the viewport when the editor is partially scrolled\n//     out of view.\nexport function menuBar(options) {\n  return new Plugin({\n    view(editorView) { return new MenuBarView(editorView, options) }\n  })\n}\n\nclass MenuBarView {\n  constructor(editorView, options) {\n    this.editorView = editorView\n    this.options = options\n\n    this.wrapper = crel(\"div\", {class: prefix + \"-wrapper\"})\n    this.menu = this.wrapper.appendChild(crel(\"div\", {class: prefix}))\n    this.menu.className = prefix\n    this.spacer = null\n\n    editorView.dom.parentNode.replaceChild(this.wrapper, editorView.dom)\n    this.wrapper.appendChild(editorView.dom)\n\n    this.maxHeight = 0\n    this.widthForMaxHeight = 0\n    this.floating = false\n\n    let {dom, update} = renderGrouped(this.editorView, this.options.content)\n    this.contentUpdate = update\n    this.menu.appendChild(dom)\n    this.update()\n\n    if (options.floating && !isIOS()) {\n      this.updateFloat()\n      let potentialScrollers = getAllWrapping(this.wrapper)\n      this.scrollFunc = (e) => {\n        let root = this.editorView.root\n        if (!(root.body || root).contains(this.wrapper)) {\n            potentialScrollers.forEach(el => el.removeEventListener(\"scroll\", this.scrollFunc))\n        } else {\n            this.updateFloat(e.target.getBoundingClientRect && e.target)\n        }\n      }\n      potentialScrollers.forEach(el => el.addEventListener('scroll', this.scrollFunc))\n    }\n  }\n\n  update() {\n    this.contentUpdate(this.editorView.state)\n\n    if (this.floating) {\n      this.updateScrollCursor()\n    } else {\n      if (this.menu.offsetWidth != this.widthForMaxHeight) {\n        this.widthForMaxHeight = this.menu.offsetWidth\n        this.maxHeight = 0\n      }\n      if (this.menu.offsetHeight > this.maxHeight) {\n        this.maxHeight = this.menu.offsetHeight\n        this.menu.style.minHeight = this.maxHeight + \"px\"\n      }\n    }\n  }\n\n  updateScrollCursor() {\n    let selection = this.editorView.root.getSelection()\n    if (!selection.focusNode) return\n    let rects = selection.getRangeAt(0).getClientRects()\n    let selRect = rects[selectionIsInverted(selection) ? 0 : rects.length - 1]\n    if (!selRect) return\n    let menuRect = this.menu.getBoundingClientRect()\n    if (selRect.top < menuRect.bottom && selRect.bottom > menuRect.top) {\n      let scrollable = findWrappingScrollable(this.wrapper)\n      if (scrollable) scrollable.scrollTop -= (menuRect.bottom - selRect.top)\n    }\n  }\n\n  updateFloat(scrollAncestor) {\n    let parent = this.wrapper, editorRect = parent.getBoundingClientRect(),\n        top = scrollAncestor ? Math.max(0, scrollAncestor.getBoundingClientRect().top) : 0\n\n    if (this.floating) {\n      if (editorRect.top >= top || editorRect.bottom < this.menu.offsetHeight + 10) {\n        this.floating = false\n        this.menu.style.position = this.menu.style.left = this.menu.style.top = this.menu.style.width = \"\"\n        this.menu.style.display = \"\"\n        this.spacer.parentNode.removeChild(this.spacer)\n        this.spacer = null\n      } else {\n        let border = (parent.offsetWidth - parent.clientWidth) / 2\n        this.menu.style.left = (editorRect.left + border) + \"px\"\n        this.menu.style.display = (editorRect.top > window.innerHeight ? \"none\" : \"\")\n        if (scrollAncestor) this.menu.style.top = top + \"px\"\n      }\n    } else {\n      if (editorRect.top < top && editorRect.bottom >= this.menu.offsetHeight + 10) {\n        this.floating = true\n        let menuRect = this.menu.getBoundingClientRect()\n        this.menu.style.left = menuRect.left + \"px\"\n        this.menu.style.width = menuRect.width + \"px\"\n        if (scrollAncestor) this.menu.style.top = top + \"px\"\n        this.menu.style.position = \"fixed\"\n        this.spacer = crel(\"div\", {class: prefix + \"-spacer\", style: `height: ${menuRect.height}px`})\n        parent.insertBefore(this.spacer, this.menu)\n      }\n    }\n  }\n\n  destroy() {\n    if (this.wrapper.parentNode)\n      this.wrapper.parentNode.replaceChild(this.editorView.dom, this.wrapper)\n  }\n}\n\n// Not precise, but close enough\nfunction selectionIsInverted(selection) {\n  if (selection.anchorNode == selection.focusNode) return selection.anchorOffset > selection.focusOffset\n  return selection.anchorNode.compareDocumentPosition(selection.focusNode) == Node.DOCUMENT_POSITION_FOLLOWING\n}\n\nfunction findWrappingScrollable(node) {\n  for (let cur = node.parentNode; cur; cur = cur.parentNode)\n    if (cur.scrollHeight > cur.clientHeight) return cur\n}\n\nfunction getAllWrapping(node) {\n    let res = [window]\n    for (let cur = node.parentNode; cur; cur = cur.parentNode)\n        res.push(cur)\n    return res\n}\n"],"names":["const","let","prefix","this","update","joinUp","lift","selectParentNode","undo","redo","wrapIn","setBlockType","Plugin"],"mappings":"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"}